
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Neo Glass Banking System — Stay Tuned LLP</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: #0f1724;
    --card: rgba(255,255,255,0.06);
    --glass: rgba(255,255,255,0.06);
    --accent: rgba(0,153,255,0.95);
    --muted: rgba(255,255,255,0.6);
    --glass-border: rgba(255,255,255,0.08);
    --success: #16a34a;
    --danger: #ef4444;
  }
  /* Light theme variables (swapped when .light) */
  .light {
    --bg: #eef2ff;
    --card: rgba(255,255,255,0.6);
    --glass: rgba(255,255,255,0.6);
    --accent: rgba(0,102,204,1);
    --muted: rgba(17,24,39,0.7);
    --glass-border: rgba(17,24,39,0.06);
  }

  html,body { height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; background: linear-gradient(180deg,#071227 0%, #0f2340 100%); color:var(--muted); }

  body.containerized {
    display:flex; align-items:center; justify-content:center; padding:24px;
    background: radial-gradient(600px 300px at 10% 10%, rgba(0,120,255,0.08), transparent),
                radial-gradient(500px 250px at 90% 80%, rgba(255,0,170,0.04), transparent);
    min-height:100vh;
  }

  .app {
    width: 100%;
    max-width: 1100px;
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 20px;
  }

  /* GLASS PANEL */
  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border-radius: 14px;
    padding: 18px;
    backdrop-filter: blur(10px) saturate(120%);
    border: 1px solid var(--glass-border);
    box-shadow: 0 6px 30px rgba(2,6,23,0.6);
    color:var(--muted);
  }

  .header {
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;
  }
  .brand {
    display:flex; align-items:center; gap:12px;
  }
  .logo {
    width:46px; height:46px; border-radius:12px;
    background: linear-gradient(135deg,var(--accent), #7a00ff);
    display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px;
    box-shadow: 0 6px 18px rgba(10,20,40,0.35);
  }
  h1 { font-size:16px; margin:0; color:var(--muted); }
  p.subtitle { margin:0; font-size:12px; color:rgba(255,255,255,0.6); }

  .controls { display:flex; gap:10px; align-items:center; }
  .btn {
    background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border:1px solid var(--glass-border);
    padding:8px 12px; border-radius:10px; color:var(--muted); cursor:pointer; font-weight:600;
  }
  .btn.primary { background:linear-gradient(90deg,var(--accent), #7a00ff); color:white; border:none; box-shadow:0 8px 30px rgba(0,122,255,0.18); }
  .btn.positive { background: linear-gradient(90deg, rgba(16,185,129,0.9), rgba(34,197,94,0.9)); color:white; border:none; }
  .btn.danger { background: linear-gradient(90deg, rgba(239,68,68,0.9), rgba(220,38,38,0.9)); color:white; border:none; }

  label { display:block; font-size:12px; color:var(--muted); margin-top:12px; margin-bottom:6px; }
  input[type="text"], input[type="number"], select {
    width:100%; padding:10px; border-radius:10px; border:1px solid var(--glass-border); background:transparent; color:var(--muted);
  }
  .small { font-size:13px; color:var(--muted); }

  .tx-list { margin-top:12px; display:flex; flex-direction:column; gap:10px; max-height:240px; overflow:auto; padding-right:6px; }
  .tx-item {
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:8px; border-radius:10px; border:1px solid var(--glass-border);
  }
  .tx-left { display:flex; gap:12px; align-items:center; }
  .tx-type { font-weight:700; font-size:13px; color:var(--muted); padding:6px 8px; border-radius:8px; background:rgba(255,255,255,0.02); }
  .tx-amount { font-weight:600; color:var(--muted); font-size:14px; }

  .tx-actions { display:flex; gap:8px; align-items:center; }

  /* Right panel summary */
  .summary { display:flex; flex-direction:column; gap:12px; }
  .card { padding:14px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid var(--glass-border); }

  pre { background:transparent; color:var(--muted); border:none; white-space:pre-wrap; word-wrap:break-word; margin:0; font-size:13px; }

  /* small helpers */
  .muted { color:rgba(255,255,255,0.6); font-size:13px; }
  .row { display:flex; gap:10px; align-items:center; }
  .flex { flex:1; }
  .top-actions { display:flex; gap:8px; align-items:center; justify-content:flex-end; }

  .search { display:flex; gap:8px; align-items:center; margin-top:8px; }
  .search input { width:220px; }

  .account-list { margin-top:10px; }

  .print-area { display:none; } /* used for print view */
  @media print {
    body * { visibility: hidden; }
    .print-area, .print-area * { visibility: visible; }
    .print-area { position: absolute; left: 0; top: 0; width:100%; }
  }

  /* responsive */
  @media(max-width:980px){
    .app { grid-template-columns: 1fr; }
  }
</style>
</head>
<body class="containerized">

<div class="app">

  <!-- LEFT: Input & transaction builder -->
  <div class="panel">
    <div class="header">
      <div class="brand">
        <div class="logo">ST</div>
        <div>
          <h1>Stay Tuned LLP — Banking</h1>
          <p class="subtitle">Neo Glass Banking System • Task 1</p>
        </div>
      </div>

      <div class="controls">
        <button id="themeToggle" class="btn">Toggle Theme</button>
        <button id="printBtn" class="btn" title="Export printable summary">Export PDF</button>
      </div>
    </div>

    <!-- Account inputs -->
    <label>Account Number</label>
    <input id="accNumber" type="text" placeholder="e.g. ACC101" />

    <label>Account Holder Name</label>
    <input id="accHolder" type="text" placeholder="e.g. Akash" />

    <label>Initial Balance</label>
    <input id="initBalance" type="text" placeholder="e.g. 2000" />

    <label>Currency</label>
    <input id="currency" type="text" placeholder="INR / USD" />

    <hr style="margin:14px 0; border:none; height:1px; background:var(--glass-border);" />

    <div class="row">
      <div style="flex:1">
        <label>Transaction Type</label>
        <select id="txType">
          <option value="">Select</option>
          <option value="Deposit">Deposit</option>
          <option value="Withdraw">Withdraw</option>
        </select>
      </div>
      <div style="width:120px">
        <label>Amount</label>
        <input id="txAmount" type="number" step="0.01" placeholder="0.00" />
      </div>
    </div>

    <div style="display:flex; gap:8px; margin-top:10px;">
      <button id="addTxBtn" class="btn positive" style="flex:1">Add Transaction</button>
      <button id="clearTxBtn" class="btn" style="width:120px">Clear</button>
    </div>

    <div class="tx-list" id="txList" aria-live="polite"></div>

    <div style="display:flex; gap:8px; margin-top:12px; justify-content:space-between;">
      <div style="display:flex; gap:8px;">
        <button id="processBtn" class="btn primary">Process Account</button>
        <button id="saveAccountBtn" class="btn">Save Account</button>
      </div>

      <div style="text-align:right;">
        <label style="font-size:12px; color:var(--muted)">Saved Accounts</label>
        <select id="savedAccounts" style="padding:8px; border-radius:8px; background:transparent; border:1px solid var(--glass-border)"></select>
      </div>
    </div>

    <div class="search">
      <input id="searchName" type="text" placeholder="Search by account holder name..." />
      <button id="searchBtn" class="btn">Search</button>
    </div>

    <p class="muted" style="margin-top:12px;">Tip: Use "Export PDF" for printable report. Saved accounts persist in your browser.</p>
  </div>


  <!-- RIGHT: Summary & history -->
  <div class="panel summary">
    <div class="top-actions">
      <div class="muted">Processed summary appears here</div>
    </div>

    <div id="summaryCard" class="card">
      <h3 style="margin:0 0 8px 0;">Account Summary</h3>
      <div id="summaryContent" class="muted">No processed account yet.</div>
    </div>

    <div class="card">
      <h4 style="margin:0 0 8px 0;">Applied Transactions</h4>
      <div id="appliedArea"><div class="muted">No applied transactions.</div></div>
    </div>

    <div class="card">
      <h4 style="margin:0 0 8px 0;">Rejected Transactions</h4>
      <div id="rejectedArea"><div class="muted">No rejected transactions.</div></div>
    </div>

    <div class="card">
      <h4 style="margin:0 0 8px 0;">Saved Accounts</h4>
      <div id="savedList" class="account-list muted">No saved accounts</div>
    </div>

  </div>
</div>

<!-- Printable area (cloned when printing) -->
<div id="printArea" class="print-area"></div>

<script>
/*
  Neo Glass Banking System
  - All processing uses try / catch / finally
  - Transactions can be added/edited/deleted
  - Save / Load accounts via localStorage
  - Search by account holder name
  - Export (print) summary
  - Original input preserved (deep copies)
*/

/* ---------- Storage Helpers ---------- */
const STORAGE_KEY = "neo_glass_bank_accounts";

/** Load saved accounts from localStorage */
function loadSavedAccounts() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return [];
    const arr = JSON.parse(raw);
    if (!Array.isArray(arr)) return [];
    return arr;
  } catch (e) {
    console.error("Error loading saved accounts:", e.message);
    return [];
  }
}

/** Save accounts array to localStorage */
function saveAccountsToStorage(accounts) {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
  } catch (e) {
    console.error("Error saving accounts:", e.message);
    alert("Unable to save accounts to localStorage: " + e.message);
  }
}

/* ---------- UI State ---------- */
let txs = []; // current transaction builder array
let lastProcessedSummary = null;

/* ---------- DOM Elements ---------- */
const txListEl = document.getElementById("txList");
const appliedArea = document.getElementById("appliedArea");
const rejectedArea = document.getElementById("rejectedArea");
const summaryContent = document.getElementById("summaryContent");
const savedList = document.getElementById("savedList");
const savedAccountsSelect = document.getElementById("savedAccounts");

/* ---------- Initialize saved accounts dropdown ---------- */
function refreshSavedAccountsUI() {
  const saved = loadSavedAccounts();
  savedAccountsSelect.innerHTML = "<option value=''>-- Select saved account --</option>";
  if (saved.length === 0) {
    savedList.innerHTML = '<div class="muted">No saved accounts</div>';
  } else {
    savedList.innerHTML = '';
    saved.forEach((acc, idx) => {
      const div = document.createElement("div");
      div.style.padding = "8px 0";
      div.innerHTML = `<b>${acc.accountHolder}</b> — ${acc.accountNumber} — ${acc.currency} — Opening: ${acc.openingBalance} — Final: ${acc.finalBalance}`;
      savedList.appendChild(div);
      // populate dropdown
      const opt = document.createElement("option");
      opt.value = idx;
      opt.text = `${acc.accountHolder} • ${acc.accountNumber}`;
      savedAccountsSelect.appendChild(opt);
    });
  }
}
refreshSavedAccountsUI();

/* ---------- Transaction list UI helpers ---------- */
function renderTxList() {
  txListEl.innerHTML = "";
  if (txs.length === 0) {
    txListEl.innerHTML = `<div class="muted">No transactions added yet.</div>`;
    return;
  }
  txs.forEach((tx, i) => {
    const item = document.createElement("div");
    item.className = "tx-item";
    item.innerHTML = `
      <div class="tx-left">
        <div class="tx-type">${tx.type || "—"}</div>
        <div class="tx-amount">${Number(tx.amount).toFixed(2)}</div>
      </div>
      <div class="tx-actions">
        <button class="btn" data-action="edit" data-i="${i}">Edit</button>
        <button class="btn" data-action="delete" data-i="${i}">Delete</button>
      </div>
    `;
    txListEl.appendChild(item);
  });
}

/* Add / Edit / Delete handlers */
document.getElementById("addTxBtn").addEventListener("click", () => {
  const type = document.getElementById("txType").value;
  const amount = document.getElementById("txAmount").value;
  if (!type || amount === "") { alert("Please enter both transaction type and amount."); return; }
  // push as strings to simulate possibly mixed input
  txs.push({ type, amount: amount });
  renderTxList();
  document.getElementById("txAmount").value = "";
  document.getElementById("txType").value = "";
});

document.getElementById("clearTxBtn").addEventListener("click", () => {
  txs = [];
  renderTxList();
});

/* delegate edit/delete */
txListEl.addEventListener("click", (ev) => {
  const btn = ev.target.closest("button");
  if (!btn) return;
  const action = btn.dataset.action;
  const idx = Number(btn.dataset.i);
  if (action === "delete") {
    if (!confirm("Delete this transaction?")) return;
    txs.splice(idx,1);
    renderTxList();
  } else if (action === "edit") {
    const current = txs[idx];
    const newType = prompt("Edit type (Deposit / Withdraw):", current.type) || current.type;
    const newAmount = prompt("Edit amount:", current.amount) || current.amount;
    // update
    txs[idx] = { type: newType, amount: newAmount };
    renderTxList();
  }
});

/* ---------- Validation helpers ---------- */
function validateTransactionFields(tx) {
  if (!tx.type || tx.type.trim() === "") throw new Error("Missing transaction type");
  if (!tx.hasOwnProperty("amount")) throw new Error("Missing amount field");
}

/* ---------- Processing logic (main) ---------- */
function processBankAccountUI(accountData) {
  // Must use try/catch/finally for processing
  let applied = [];
  let rejected = [];
  let finalBalance = 0;

  // Deep copy input so original is not modified
  const input = JSON.parse(JSON.stringify(accountData));

  try {
    // Convert initial balance
    const opening = Number(input.initialBalance);
    if (isNaN(opening) || opening < 0) {
      throw new Error("Invalid opening balance");
    }
    finalBalance = opening;

    // Ensure transactions array
    const list = Array.isArray(input.transactions) ? input.transactions : [];

    // Process each transaction inside its own try/catch
    for (const tx of list) {
      try {
        validateTransactionFields(tx);

        const amount = Number(tx.amount);
        if (isNaN(amount)) throw new Error("Invalid amount (not a number)");
        if (amount <= 0) throw new Error("Amount must be greater than zero");

        if (tx.type === "Deposit") {
          finalBalance += amount;
          applied.push({ type: tx.type, amount: amount, status: "Applied" });

        } else if (tx.type === "Withdraw") {
          if (amount > finalBalance) throw new Error("Insufficient balance");
          finalBalance -= amount;
          applied.push({ type: tx.type, amount: amount, status: "Applied" });

        } else {
          throw new Error("Unknown transaction type");
        }

      } catch (txErr) {
        rejected.push({ transaction: tx, reason: txErr.message });
      }
    }

    // Build summary object
    const summary = {
      accountNumber: input.accountNumber || "",
      accountHolder: input.accountHolder || "",
      currency: input.currency || "",
      openingBalance: input.initialBalance,
      finalBalance: Number(finalBalance.toFixed(2)),
      appliedTransactions: applied,
      rejectedTransactions: rejected,
      processedAt: new Date().toISOString(),
      log: "Processed via UI"
    };

    lastProcessedSummary = summary;
    updateSummaryUI(summary);

    return summary;

  } catch (err) {
    // System error
    console.error("SYSTEM ERROR:", err.message);
    // Build error summary
    const summary = {
      accountNumber: input.accountNumber || "",
      accountHolder: input.accountHolder || "",
      currency: input.currency || "",
      openingBalance: input.initialBalance || "",
      finalBalance: finalBalance,
      appliedTransactions: applied,
      rejectedTransactions: rejected,
      processedAt: new Date().toISOString(),
      log: "System Error",
      systemError: err.message
    };
    lastProcessedSummary = summary;
    updateSummaryUI(summary);
    return summary;
  } finally {
    // Always display completion message
    console.log("Processing complete (finally)");
    // refresh saved accounts UI preview (not saved yet)
    renderAppliedRejected(applied, rejected);
  }
}

/* ---------- UI: update summary & lists ---------- */
function updateSummaryUI(summary) {
  if (!summary) return;
  summaryContent.innerHTML = `
    <div>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <div style="font-size:15px; font-weight:700; color:var(--muted);">${escapeHtml(summary.accountHolder || "—")}</div>
          <div class="muted" style="margin-top:4px;">${escapeHtml(summary.accountNumber || "—")} • ${escapeHtml(summary.currency || "—")}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-size:14px; font-weight:700; color:var(--muted);">Final: ${Number(summary.finalBalance || 0).toFixed(2)}</div>
          <div class="muted" style="font-size:12px;">Opening: ${escapeHtml(summary.openingBalance || "0")}</div>
        </div>
      </div>

      <div style="margin-top:10px;">
        <div class="muted">Processed at: ${new Date(summary.processedAt).toLocaleString()}</div>
        ${summary.systemError ? `<div style="color:var(--danger); margin-top:6px;"><b>System Error:</b> ${escapeHtml(summary.systemError)}</div>` : ""}
      </div>
    </div>
  `;
}

/* Render applied & rejected */
function renderAppliedRejected(applied, rejected) {
  appliedArea.innerHTML = "";
  rejectedArea.innerHTML = "";

  if (!applied || applied.length === 0) appliedArea.innerHTML = `<div class="muted">No applied transactions</div>`;
  else {
    applied.forEach(tx => {
      const div = document.createElement("div");
      div.style.padding = "6px 0";
      div.innerHTML = `<b>${escapeHtml(tx.type)}</b> — ${Number(tx.amount).toFixed(2)} • ${tx.status}`;
      appliedArea.appendChild(div);
    });
  }

  if (!rejected || rejected.length === 0) rejectedArea.innerHTML = `<div class="muted">No rejected transactions</div>`;
  else {
    rejected.forEach(r => {
      const div = document.createElement("div");
      div.style.padding = "6px 0";
      div.innerHTML = `<b>${escapeHtml(r.transaction.type || "—")}</b> — ${escapeHtml(String(r.transaction.amount || ""))} • <span style="color:var(--danger)">${escapeHtml(r.reason)}</span>`;
      rejectedArea.appendChild(div);
    });
  }
}

/* ---------- Save processed account ---------- */
document.getElementById("saveAccountBtn").addEventListener("click", () => {
  try {
    if (!lastProcessedSummary) { alert("Process an account first, then save."); return; }
    const saved = loadSavedAccounts();
    // store shallow copy to avoid accidental mutation later
    const copy = JSON.parse(JSON.stringify(lastProcessedSummary));
    saved.push(copy);
    saveAccountsToStorage(saved);
    refreshSavedAccountsUI();
    alert("Account saved locally.");
  } catch (e) {
    alert("Error saving account: " + e.message);
  }
});

/* ---------- Process button ---------- */
document.getElementById("processBtn").addEventListener("click", () => {
  const obj = {
    accountNumber: document.getElementById("accNumber").value.trim(),
    accountHolder: document.getElementById("accHolder").value.trim(),
    initialBalance: document.getElementById("initBalance").value.trim(),
    currency: document.getElementById("currency").value.trim(),
    transactions: JSON.parse(JSON.stringify(txs)) // copy so original txs array not mutated by processing
  };

  processBankAccountUI(obj);
});

/* ---------- Saved accounts select handler ---------- */
savedAccountsSelect.addEventListener("change", () => {
  const idx = savedAccountsSelect.value;
  if (idx === "") return;
  const arr = loadSavedAccounts();
  const acc = arr[Number(idx)];
  if (!acc) return;
  // Populate UI with loaded account (not processing, just load)
  document.getElementById("accNumber").value = acc.accountNumber || "";
  document.getElementById("accHolder").value = acc.accountHolder || "";
  document.getElementById("initBalance").value = acc.openingBalance || "";
  document.getElementById("currency").value = acc.currency || "";
  // reset transactions and populate with applied txs for editing
  txs = Array.isArray(acc.appliedTransactions) ? acc.appliedTransactions.map(t => ({ type: t.type, amount: Number(t.amount) })) : [];
  renderTxList();
});

/* ---------- Search by name ---------- */
document.getElementById("searchBtn").addEventListener("click", () => {
  try {
    const name = document.getElementById("searchName").value.trim().toLowerCase();
    if (!name) { alert("Enter a name to search."); return; }
    const saved = loadSavedAccounts();
    const found = saved.find(a => (a.accountHolder || "").toLowerCase() === name);
    if (!found) { alert("No account found for: " + name); return; }
    // show found summary and populate UI fields
    updateSummaryUI(found);
    renderAppliedRejected(found.appliedTransactions || [], found.rejectedTransactions || []);
    document.getElementById("accNumber").value = found.accountNumber || "";
    document.getElementById("accHolder").value = found.accountHolder || "";
    document.getElementById("initBalance").value = found.openingBalance || "";
    document.getElementById("currency").value = found.currency || "";
    // also load txs from applied list for editing
    txs = Array.isArray(found.appliedTransactions) ? found.appliedTransactions.map(t=>({type:t.type,amount:t.amount})) : [];
    renderTxList();
  } catch (e) {
    alert("Search error: " + e.message);
  }
});

/* ---------- Export / Print ---------- */
document.getElementById("printBtn").addEventListener("click", () => {
  try {
    if (!lastProcessedSummary) { alert("Process an account first to export."); return; }
    // Build print area HTML
    const s = lastProcessedSummary;
    const html = `
      <div style="font-family:Inter,Arial; padding:18px; color:#111;">
        <h2 style="margin:0 0 8px 0;">Banking Summary — ${escapeHtml(s.accountHolder || '')}</h2>
        <div style="margin-bottom:6px;">Account Number: ${escapeHtml(s.accountNumber || '')}</div>
        <div style="margin-bottom:6px;">Currency: ${escapeHtml(s.currency || '')}</div>
        <div style="margin-bottom:6px;">Opening Balance: ${escapeHtml(String(s.openingBalance || ''))}</div>
        <div style="margin-bottom:6px;">Final Balance: ${Number(s.finalBalance||0).toFixed(2)}</div>
        <h3 style="margin-top:12px;">Applied Transactions</h3>
        <pre>${escapeHtml(JSON.stringify(s.appliedTransactions||[], null, 2))}</pre>
        <h3>Rejected Transactions</h3>
        <pre>${escapeHtml(JSON.stringify(s.rejectedTransactions||[], null, 2))}</pre>
        <div style="margin-top:12px;">Processed at: ${new Date(s.processedAt).toLocaleString()}</div>
      </div>
    `;
    document.getElementById("printArea").innerHTML = html;
    window.print();
  } catch (e) {
    alert("Print error: " + e.message);
  } finally {
    // keep UI clear
    console.log("Print attempted (finally).");
  }
});

/* ---------- Theme toggle ---------- */
const body = document.body;
document.getElementById("themeToggle").addEventListener("click", () => {
  try {
    body.classList.toggle("light");
  } catch(e) {
    console.error("Theme toggle error:", e.message);
  } finally {
    console.log("Theme toggle done");
  }
});

/* ---------- escape HTML helper ---------- */
function escapeHtml(s) {
  if (s === null || s === undefined) return "";
  return String(s)
    .replace(/&/g, "&amp;")
    .replace(/"/g, "&quot;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

/* ---------- initial render ---------- */
renderTxList();
refreshSavedAccountsUI();

</script>
</body>
</html>
